# é ç´„æŸ¥è©¢ - é ç´„ç°¡è¨Šç®¡ç†ä½¿ç”¨èªªæ˜

> Dr. Shine é†«ç¾è¨ºæ‰€ - ç°¡è¨Šç®¡ç†ç³»çµ±
> æ´»èºé ç´„èˆ‡éæ´»èºé ç´„æ“ä½œé‚è¼¯

---

## ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µ

### æ´»èºé ç´„ï¼ˆActive Appointmentï¼‰

**å®šç¾©ï¼š** åªæœ‰**æœ€æ—©çš„æœ‰æ•ˆé ç´„**æ‰æ˜¯æ´»èºé ç´„ï¼Œå¯ä»¥æ“ä½œç°¡è¨Šç‹€æ…‹ã€‚

**åˆ¤æ–·è¦å‰‡ï¼š**

- åŒä¸€æœƒå“¡ + åŒä¸€å¤© + åŒä¸€ç¾¤çµ„ï¼ˆæˆ–åŒé–€å¸‚ï¼‰å…§
- é¸æ“‡**æ™‚é–“æœ€æ—©**çš„é ç´„
- æ™‚é–“ç›¸åŒæ™‚ï¼Œé¸æ“‡ **ID è¼ƒå°**çš„é ç´„

**æ”¯æ´çš„æ“ä½œï¼š**

- âœ… ç™¼é€ç°¡è¨Š
- âœ… å–æ¶ˆç°¡è¨Š
- âœ… é‡æ–°ç™¼é€ç°¡è¨Š

**æŠ€è¡“å¯¦ä½œï¼š**

- å¾Œç«¯æ–°å¢ API çµ¦å‰ç«¯åˆ¤æ–·å¯å¦æ“ä½œ
- å‰ç«¯æ ¹æ“š API å›æ‡‰æ±ºå®šæ˜¯å¦é¡¯ç¤ºæ“ä½œæŒ‰éˆ•

---

### éæ´»èºé ç´„ï¼ˆInactive Appointmentï¼‰

**å®šç¾©ï¼š** éæœ€æ—©é ç´„æˆ–å·²å¤±æ•ˆçš„é ç´„ï¼Œç„¡æ³•æ“ä½œç°¡è¨Šç‹€æ…‹ã€‚

éæ´»èºé ç´„åŒ…å«ä»¥ä¸‹ä¸‰ç¨®æƒ…æ³ï¼š

#### 1. éæœ€æ—©é ç´„ï¼ˆRead Onlyï¼‰

**é¡¯ç¤ºï¼š** é¡¯ç¤ºåŸæœ¬çš„ç°¡è¨Šç®¡ç†ç‹€æ…‹ï¼Œä½†ä¸å¯æ“ä½œ

**åˆ¤æ–·ï¼š** å¾Œç«¯æ–°å¢ API çµ¦å‰ç«¯åˆ¤æ–·ä¸å¯æ“ä½œ

**ç‹€æ…‹ç¯„ä¾‹ï¼š**

- ã€Œå·²æ’ç¨‹ã€ï¼ˆç°è‰²ï¼Œä¸å¯æ“ä½œï¼‰
- ã€Œæœªç™¼é€ã€ï¼ˆç°è‰²ï¼Œä¸å¯æ“ä½œï¼‰
- ã€Œå¾…ç™¼é€ã€ï¼ˆç°è‰²ï¼Œä¸å¯æ“ä½œï¼‰

#### 2. å·²å–æ¶ˆ/å·²åˆªé™¤çš„é ç´„ï¼ˆRead Onlyï¼‰

**é¡¯ç¤ºï¼š** é¡¯ç¤ºã€Œå·²å–æ¶ˆã€

**åˆ¤æ–·ï¼š** å‰ç«¯çœ‹æœ€å¾Œç‹€æ…‹åˆ¤æ–·ä¸å¯æ“ä½œ

**ç‹€æ…‹ç¯„ä¾‹ï¼š**

- ã€Œå·²å–æ¶ˆã€ï¼ˆç°è‰²ï¼Œä¸å¯æ“ä½œï¼‰

#### 3. å·²é€é”æˆ–å·²éæœŸçš„é ç´„ï¼ˆRead Onlyï¼‰

**é¡¯ç¤ºï¼š** é¡¯ç¤ºå¯¦éš›ç‹€æ…‹

**åˆ¤æ–·ï¼š** å‰ç«¯çœ‹æœ€å¾Œç‹€æ…‹åˆ¤æ–·ä¸å¯æ“ä½œ

**ç‹€æ…‹ç¯„ä¾‹ï¼š**

- ã€Œå·²é€é”ã€ï¼ˆç°è‰²ï¼Œä¸å¯æ“ä½œï¼‰
- ã€Œå·²éæœŸã€ï¼ˆç°è‰²ï¼Œä¸å¯æ“ä½œï¼‰

---

## ğŸ”„ è‡ªå‹•è£œä½æ©Ÿåˆ¶

### è§¸ç™¼æ¢ä»¶

ç•¶**å–æ¶ˆé ç´„**æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•æª¢æŸ¥ä¸¦æ›´æ–°æ–°çš„æœ€æ—©é ç´„ã€‚

**é‡è¦ï¼š** å–æ¶ˆç°¡è¨Š**ä¸æœƒ**è§¸ç™¼è‡ªå‹•è£œä½ã€‚

### è£œä½æµç¨‹

**åˆå§‹ç‹€æ…‹ï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ |
|---|---|---|---|
| **09:00** | æ¿æ©‹é†«ç¾ | âœ… æ´»èºï¼ˆæœ€æ—©ï¼‰ | å·²æ’ç¨‹ |
| 14:00 | æ¿æ©‹å²©ç›¤æµ´ | â¸ï¸ éæ´»èº | - |
| 16:00 | æ¿æ©‹é†«ç¾ | â¸ï¸ éæ´»èº | - |

**æ“ä½œï¼š** å–æ¶ˆ 09:00 é ç´„

**æ›´æ–°å¾Œï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ |
|---|---|---|---|---|
| 09:00 | æ¿æ©‹é†«ç¾ | âŒ å·²å–æ¶ˆ | å·²å–æ¶ˆ | âœ— |
| **14:00** | æ¿æ©‹å²©ç›¤æµ´ | âœ… æ´»èºï¼ˆè£œä½ï¼‰ | å¾…ç™¼é€ | âœ“ |
| 16:00 | æ¿æ©‹é†«ç¾ | â¸ï¸ éæ´»èº | - | âœ— |

### ä¸è§¸ç™¼è£œä½çš„æƒ…æ³

**æƒ…å¢ƒï¼š** åƒ…å–æ¶ˆç°¡è¨Šï¼Œä¸å–æ¶ˆé ç´„

**æ“ä½œï¼š** å° 09:00 é ç´„åŸ·è¡Œã€Œå–æ¶ˆç°¡è¨Šã€

**çµæœï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ |
|---|---|---|---|---|
| **09:00** | æ¿æ©‹é†«ç¾ | âœ… æ´»èºï¼ˆæœ€æ—©ï¼‰ | å·²å–æ¶ˆ | âœ“ |
| 14:00 | æ¿æ©‹å²©ç›¤æµ´ | â¸ï¸ éæ´»èº | - | âœ— |

**èªªæ˜ï¼š** é ç´„ä»å­˜åœ¨ä¸”ä»æ˜¯æœ€æ—©ï¼Œæ•…ä¸è§¸ç™¼è£œä½ã€‚

---

## ğŸ¨ UI è¦–è¦ºå‘ˆç¾è¦ç¯„

### ç‹€æ…‹é¡è‰²å®šç¾©

| ç‹€æ…‹é¡å‹ | å¯æ“ä½œ | é¡è‰² | ç¯„ä¾‹ |
|---|---|---|---|
| æ´»èºé ç´„ | âœ“ å¯æ“ä½œ | ğŸŸ¢ ç¶ è‰²/è—è‰² | ã€Œå·²æ’ç¨‹ã€å¯é»æ“Š |
| éæ´»èºé ç´„ | âœ— ä¸å¯æ“ä½œ | âš« ç°è‰² | ã€Œå·²æ’ç¨‹ã€ç°è‰²é¡¯ç¤º |
| å·²å–æ¶ˆ | âœ— ä¸å¯æ“ä½œ | âš« ç°è‰² | ã€Œå·²å–æ¶ˆã€ç°è‰²é¡¯ç¤º |
| å·²é€é” | âœ— ä¸å¯æ“ä½œ | âš« ç°è‰² | ã€Œå·²é€é”ã€ç°è‰²é¡¯ç¤º |
| å·²éæœŸ | âœ— ä¸å¯æ“ä½œ | âš« ç°è‰² | ã€Œå·²éæœŸã€ç°è‰²é¡¯ç¤º |

### é ç´„åˆ—è¡¨é¡¯ç¤ºç¯„ä¾‹

```text
ã€æ¿æ©‹é†«ç¾ã€‘2025-12-05 09:00
â”œâ”€ âœ… æ´»èºé ç´„
â”œâ”€ ğŸ“± ç°¡è¨Šç‹€æ…‹ï¼šå·²æ’ç¨‹ï¼ˆå¯æ“ä½œï¼‰
â””â”€ ğŸ”˜ [ç™¼é€] [å–æ¶ˆ] [é‡æ–°ç™¼é€]  â† å¯é»æ“ŠæŒ‰éˆ•

ã€æ¿æ©‹å²©ç›¤æµ´ã€‘2025-12-05 14:00
â”œâ”€ â¸ï¸ éæ´»èºé ç´„ï¼ˆéæœ€æ—©ï¼‰
â”œâ”€ ğŸ“± ç°¡è¨Šç‹€æ…‹ï¼šæœªæ’ç¨‹ï¼ˆä¸å¯æ“ä½œï¼‰
â””â”€ ğŸ”˜ [ç™¼é€] [å–æ¶ˆ] [é‡æ–°ç™¼é€]  â† ç°è‰²æŒ‰éˆ•ï¼Œä¸å¯é»æ“Š

ã€æ¿æ©‹é†«ç¾ã€‘2025-12-05 16:30
â”œâ”€ â¸ï¸ éæ´»èºé ç´„ï¼ˆéæœ€æ—©ï¼‰
â”œâ”€ ğŸ“± ç°¡è¨Šç‹€æ…‹ï¼šå·²å–æ¶ˆï¼ˆä¸å¯æ“ä½œï¼‰
â””â”€ ğŸ’¡ åŸå› ï¼šå·²å–æ¶ˆçš„é ç´„
```

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œé‡é»

### 1. å¾Œç«¯ API è¨­è¨ˆ

#### API ç«¯é»ï¼šåˆ¤æ–·é ç´„æ˜¯å¦å¯æ“ä½œ

**è«‹æ±‚ï¼š**

```json
GET /api/appointments/{appointmentId}/canManageSms
```

**å›æ‡‰ï¼š**

```json
{
  "canOperate": true,
  "reason": "æœ€æ—©é ç´„",
  "status": "active"
}
```

æˆ–

```json
{
  "canOperate": false,
  "reason": "éæœ€æ—©é ç´„",
  "status": "inactive"
}
```

### 2. å‰ç«¯åˆ¤æ–·é‚è¼¯

#### æ­¥é©Ÿ 1ï¼šå‘¼å« API åˆ¤æ–·å¯å¦æ“ä½œ

```javascript
const response = await fetch(`/api/appointments/${id}/canManageSms`);
const { canOperate, reason, status } = await response.json();
```

#### æ­¥é©Ÿ 2ï¼šæ ¹æ“šå›æ‡‰æ±ºå®š UI å‘ˆç¾

```javascript
if (canOperate) {
  // é¡¯ç¤ºå¯é»æ“Šçš„æŒ‰éˆ•ï¼ˆç¶ è‰²/è—è‰²ï¼‰
  showActiveButtons();
} else {
  // é¡¯ç¤ºç°è‰²ä¸å¯é»æ“Šçš„æŒ‰éˆ•
  showInactiveButtons(reason);
}
```

#### æ­¥é©Ÿ 3ï¼šåˆ¤æ–·éæ´»èºé ç´„çš„ç‹€æ…‹

```javascript
// å‰ç«¯æ ¹æ“šé ç´„ç‹€æ…‹åˆ¤æ–·
if (appointment.isCancelled || appointment.isDeleted) {
  displayStatus = "å·²å–æ¶ˆ";
  canOperate = false;
} else if (appointment.smsStatus === "å·²é€é”") {
  displayStatus = "å·²é€é”";
  canOperate = false;
} else if (appointment.isExpired) {
  displayStatus = "å·²éæœŸ";
  canOperate = false;
}
```

### 3. è‡ªå‹•è£œä½å¯¦ä½œ

#### è§¸ç™¼æ™‚æ©Ÿï¼šå–æ¶ˆé ç´„

```javascript
async function cancelAppointment(appointmentId) {
  // 1. å–æ¶ˆé ç´„
  await cancelAppointmentAPI(appointmentId);

  // 2. å¾Œç«¯è‡ªå‹•æª¢æŸ¥ä¸¦æ›´æ–°æ–°çš„æœ€æ—©é ç´„
  // 3. è¿”å›æ–°çš„æ´»èºé ç´„è³‡è¨Š
  const newActiveAppointment = await getNewActiveAppointment();

  // 4. å‰ç«¯æ›´æ–° UI
  refreshAppointmentList();
}
```

#### ä¸è§¸ç™¼è£œä½ï¼šå–æ¶ˆç°¡è¨Š

```javascript
async function cancelSms(appointmentId) {
  // 1. åƒ…å–æ¶ˆç°¡è¨Š
  await cancelSmsAPI(appointmentId);

  // 2. ä¸æœƒè§¸ç™¼è‡ªå‹•è£œä½
  // 3. é ç´„ä»æ˜¯æ´»èºç‹€æ…‹

  // 4. å‰ç«¯æ›´æ–° UI
  refreshSmsStatus();
}
```

---

## ğŸ“Š å®Œæ•´æƒ…å¢ƒç¯„ä¾‹

### æƒ…å¢ƒ 1ï¼šæ¨™æº–æ´»èºé ç´„æ“ä½œ

**æœƒå“¡ï¼š** ç‹å°æ˜
**æ—¥æœŸï¼š** 2025-12-05
**ç¾¤çµ„ï¼š** æ¿æ©‹å€åŸŸï¼ˆç¾¤çµ„3ï¼‰

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ | UI é¡¯ç¤º |
|---|---|---|---|---|---|
| **09:00** | æ¿æ©‹é†«ç¾ | âœ… æ´»èº | å·²æ’ç¨‹ | âœ“ | ğŸŸ¢ å¯é»æ“ŠæŒ‰éˆ• |
| 14:00 | æ¿æ©‹å²©ç›¤æµ´ | â¸ï¸ éæ´»èº | - | âœ— | âš« ç°è‰²æŒ‰éˆ• |
| 16:30 | æ¿æ©‹é†«ç¾ | â¸ï¸ éæ´»èº | - | âœ— | âš« ç°è‰²æŒ‰éˆ• |

**æ“ä½œçµæœï¼š**

- åªæœ‰ 09:00 é ç´„å¯ä»¥åŸ·è¡Œã€Œç™¼é€ã€ã€ã€Œå–æ¶ˆã€ã€ã€Œé‡æ–°ç™¼é€ã€
- 14:00 å’Œ 16:30 é ç´„é¡¯ç¤ºç°è‰²ï¼Œä¸å¯æ“ä½œ

### æƒ…å¢ƒ 2ï¼šæ™‚é–“ç›¸åŒæ™‚é¸æ“‡ ID è¼ƒå°çš„

**æœƒå“¡ï¼š** æç¾éº—
**æ—¥æœŸï¼š** 2025-12-06
**ç¾¤çµ„ï¼š** ä¸­å£¢å½¤é¡å€åŸŸï¼ˆç¾¤çµ„4ï¼‰

| æ™‚é–“ | é–€å¸‚ | é ç´„ID | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ |
|---|---|---|---|---|---|
| **10:00** | ä¸­å£¢å½¤é¡å¥ä¿ | A001 | âœ… æ´»èº | å·²æ’ç¨‹ | âœ“ |
| 10:00 | ä¸­å£¢å½¤é¡é†«ç¾ | A002 | â¸ï¸ éæ´»èº | - | âœ— |
| 10:00 | ä¸­å£¢å²©ç›¤æµ´ | A003 | â¸ï¸ éæ´»èº | - | âœ— |

**åˆ¤æ–·é‚è¼¯ï¼š** æ™‚é–“éƒ½æ˜¯ 10:00ï¼Œé¸æ“‡ ID æœ€å°çš„ A001 ä½œç‚ºæ´»èºé ç´„

### æƒ…å¢ƒ 3ï¼šå–æ¶ˆé ç´„è§¸ç™¼è‡ªå‹•è£œä½

**åˆå§‹ç‹€æ…‹ï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ |
|---|---|---|---|---|
| **09:00** | æ¿æ©‹é†«ç¾ | âœ… æ´»èº | å·²æ’ç¨‹ | âœ“ |
| 14:00 | æ¿æ©‹å²©ç›¤æµ´ | â¸ï¸ éæ´»èº | - | âœ— |

**æ“ä½œï¼š** å–æ¶ˆ 09:00 é ç´„

**æ›´æ–°å¾Œï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ | è®ŠåŒ– |
|---|---|---|---|---|---|
| 09:00 | æ¿æ©‹é†«ç¾ | âŒ å·²å–æ¶ˆ | å·²å–æ¶ˆ | âœ— | ğŸ”´ è®Šç‚ºä¸å¯æ“ä½œ |
| **14:00** | æ¿æ©‹å²©ç›¤æµ´ | âœ… æ´»èº | å¾…ç™¼é€ | âœ“ | ğŸŸ¢ è‡ªå‹•è£œä½ç‚ºæ´»èº |

**ç³»çµ±è¡Œç‚ºï¼š**

1. å¾Œç«¯åµæ¸¬åˆ°æœ€æ—©é ç´„è¢«å–æ¶ˆ
2. è‡ªå‹•å°‡ 14:00 é ç´„è¨­ç‚ºæ–°çš„æ´»èºé ç´„
3. å‰ç«¯æ”¶åˆ°æ›´æ–°ï¼Œ14:00 æŒ‰éˆ•è®Šç‚ºå¯é»æ“Š

### æƒ…å¢ƒ 4ï¼šå–æ¶ˆç°¡è¨Šä¸è§¸ç™¼è£œä½

**åˆå§‹ç‹€æ…‹ï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ |
|---|---|---|---|---|
| **09:00** | æ¿æ©‹é†«ç¾ | âœ… æ´»èº | å·²æ’ç¨‹ | âœ“ |
| 14:00 | æ¿æ©‹å²©ç›¤æµ´ | â¸ï¸ éæ´»èº | - | âœ— |

**æ“ä½œï¼š** å° 09:00 é ç´„åŸ·è¡Œã€Œå–æ¶ˆç°¡è¨Šã€

**æ›´æ–°å¾Œï¼š**

| æ™‚é–“ | é–€å¸‚ | é ç´„ç‹€æ…‹ | ç°¡è¨Šç‹€æ…‹ | å¯æ“ä½œ | è®ŠåŒ– |
|---|---|---|---|---|---|
| **09:00** | æ¿æ©‹é†«ç¾ | âœ… æ´»èº | å·²å–æ¶ˆ | âœ“ | ç°¡è¨Šç‹€æ…‹æ”¹è®Šï¼Œä»å¯æ“ä½œ |
| 14:00 | æ¿æ©‹å²©ç›¤æµ´ | â¸ï¸ éæ´»èº | - | âœ— | ç„¡è®ŠåŒ– |

**ç³»çµ±è¡Œç‚ºï¼š**

1. åƒ…å–æ¶ˆ 09:00 çš„ç°¡è¨Šç™¼é€
2. é ç´„æœ¬èº«ä»å­˜åœ¨ä¸”ä»æ˜¯æœ€æ—©
3. 14:00 é ç´„ä¿æŒéæ´»èºç‹€æ…‹
4. 09:00 é ç´„ä»å¯åŸ·è¡Œã€Œç™¼é€ã€ã€ã€Œé‡æ–°ç™¼é€ã€ç­‰æ“ä½œ

---

## ğŸ“Œ é‡è¦æé†’

### 1. æ“ä½œæ¬Šé™åˆ¤æ–·

- **å¾Œç«¯è² è²¬ï¼š** åˆ¤æ–·é ç´„æ˜¯å¦ç‚ºæœ€æ—©æœ‰æ•ˆé ç´„
- **å‰ç«¯è² è²¬ï¼š** åˆ¤æ–·å·²å–æ¶ˆ/å·²é€é”/å·²éæœŸç­‰ç‹€æ…‹
- **å”åŒåˆ¤æ–·ï¼š** å¾Œç«¯ API + å‰ç«¯ç‹€æ…‹ = æœ€çµ‚å¯å¦æ“ä½œ

### 2. è‡ªå‹•è£œä½è§¸ç™¼æ¢ä»¶

- âœ… **æœƒè§¸ç™¼ï¼š** å–æ¶ˆé ç´„ï¼ˆdelete/cancel appointmentï¼‰
- âœ— **ä¸è§¸ç™¼ï¼š** å–æ¶ˆç°¡è¨Šï¼ˆcancel SMS onlyï¼‰
- âœ— **ä¸è§¸ç™¼ï¼š** ä¿®æ”¹é ç´„æ™‚é–“ï¼ˆupdate appointment timeï¼‰

### 3. UI ä¸€è‡´æ€§åŸå‰‡

- æ‰€æœ‰ä¸å¯æ“ä½œç‹€æ…‹çµ±ä¸€ä½¿ç”¨**ç°è‰²**
- æ´»èºé ç´„ä½¿ç”¨**ç¶ è‰²**æˆ–**è—è‰²**
- æŒ‰éˆ•æ–‡å­—ä¿æŒä¸€è‡´ï¼šã€Œç™¼é€ã€ã€ã€Œå–æ¶ˆã€ã€ã€Œé‡æ–°ç™¼é€ã€

### 4. è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥

ç¢ºä¿å‰å¾Œç«¯ç‹€æ…‹åŒæ­¥ï¼š

```javascript
// å®šæœŸæª¢æŸ¥æ´»èºé ç´„ç‹€æ…‹
setInterval(async () => {
  const status = await checkActiveAppointmentStatus();
  if (status.hasChanged) {
    refreshAppointmentList();
  }
}, 30000); // æ¯ 30 ç§’æª¢æŸ¥ä¸€æ¬¡
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- **å„ªåŒ–v2.0.md** - å®Œæ•´æŠ€è¡“è¦æ ¼èˆ‡æ¥­å‹™é‚è¼¯
- **README.md** - å°ˆæ¡ˆæ¦‚è¿°èˆ‡å¿«é€Ÿé–‹å§‹
- **QQQ.md** - UI äº’å‹•è¨­è¨ˆè¦ç¯„

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** v2.0
**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-02
**ç¶­è­·å–®ä½ï¼š** Dr. Shine ç°¡è¨Šç®¡ç†ç³»çµ±å°ˆæ¡ˆçµ„
