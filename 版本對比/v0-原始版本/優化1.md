# 簡訊發送優化方案

> 預約管理系統 - 智能簡訊排程
> 完整27門市規劃 - 會議討論版

**本次更新重點:**
- **決策四優化：** 在取消/新增預約**前**先檢測並彈出確認視窗
- 讓用戶有反悔機會，避免誤操作
- 門市群組規劃：5組共11家門市（板橋光澤健保調整為獨立門市）

---

# 📋 需求概述與基本規則

> ### 🎯 核心目標
> **避免同一天多個預約重複發送簡訊**，降低簡訊成本並改善顧客體驗

## 優化規則（兩層判斷）

> **規則一：消耗區域門市群組** (優先判斷)
>
> • **同一天 + 同一門市群組**內的預約 → 只發送**最早**的一封簡訊
> • 門市群組代表顧客可以在這些門市間「互相消耗療程」
> • 例：板橋醫美 + 板橋岩盤浴屬於同一群組（群組3）
> • **共11家門市**分為5個群組

> **規則二：單一門市規則** (次要判斷)
>
> • 若門市**不在任何群組**內 → 採用「同一門市」規則
> • **同一天 + 同一門市**的多個預約 → 只發送**最早**的簡訊
> • 例：新竹光澤診所（獨立門市）當天多預約只發一封

> ⚠️ **重要前提**
> 每個預約對應一封簡訊的設計不變（**不考慮合併簡訊**），僅透過「跳過發送」來達到優化目的

## 判斷總流程圖

> **任何預約操作 (新增/修改/取消)**
> ▼
> **第一關：客戶資格檢查 (黑/白/特殊名單)**
> → 若不通過，則引導取消發送並引導取消發送。
> ▼
> **第二關：執行 SYSGroup 規則判斷**
> 判斷是否為群組/門市內的「最早預約」。
> ▼
> **第三關：彈出「發送預覽」視窗**
> 根據前兩關的結果，決定彈窗的內容與樣式。
> ▼
> **使用者最終確認**

---

# 🔐 簡訊發送前置條件 - 客戶資格檢查

> ### ⚠️ 通用規則 - 適用於所有簡訊發送場景
> **此檢查邏輯在任何簡訊發送前都會執行，包括：**
> ✓ 新建預約的簡訊提醒
> ✓ 預約修改（改時間/改門市）的重新提醒
> ✓ 取消最早預約後的次早補發
> ✓ 新增更早預約的簡訊發送
> ✓ 所有會進入「發出簡訊內容」介面的操作

## 客戶資格檢查規則

> **最終判斷流程 v2.5** (預設啟用)
>
> **第一關：黑名單檢查 (絕對優先)**
> 針對 `Type: 標註` 的預約，檢查 `Mark` 欄位是否包含以下任一關鍵字:
> `無`, `拒`, `沒`, `員工`, `醫師`, `離職`, `暫停`, `誤`, `簡訊`, `澳門`, `香港`, `大陸`, `空號`, `非本人`, `過世`, `往生`, `SPY`, `孕`, `客訴`, `歿`, `間諜`
> → 若符合，直接引導取消發送，流程結束。
>
> **第二關：特殊規則檢查 (內含白名單例外)**
> 針對 `Type: 標註` 的預約，若 `Mark` 欄位符合以下任一規則，則進行白名單例外檢查。
> - 包含「勿」但**不包含**「勿久等」
> - 包含「不」但**不包含**「推/call/摳/電/聯」
> → 若同時包含白名單關鍵字 (`天使`, `好友`)，則直接通過，流程結束。
> → 若不含白名單，則引導取消發送，流程結束。
>
> **第三關：電訪銷開關檢查**
> 僅當後台開關打開時，檢查 `promote` 欄位是否為 `0`, `10`, `20`。
> → 若開關打開且符合條件，則引導取消發送，流程結束。
>
> **第四關：預設通過**
> 若預約資訊能通過前面所有關卡的檢查。
> → 正常，可發送。

> **Type: 接受電訪/銷 - 前端開關控制** (預設關閉)
> #### 🎛️ 開關說明
> **開關關閉（預設）：**不檢查此項，所有 promote 狀態的客戶都可發送
> **開關打開：**額外過濾 promote 為 0、10、20 的客戶
>
> | promote 值 | 狀態說明 | 開關關閉 | 開關打開 |
> |---|---|---|---|
> | **0** | 拒絕 | ✓ 發送 | ✗ 不發送 |
> | **10** | 勿Call勿約 | ✓ 發送 | ✗ 不發送 |
> | **20** | 勿call可line | ✓ 發送 | ✗ 不發送 |
> | 其他 | NULL 或其他值 | ✓ 發送 | ✓ 發送 |

## 測試案例範例

| Type | Mark / promote | 判斷結果 (黑名單 > 特殊規則(含白名單) > 電訪銷) | 是否發送 |
|---|---|---|---|
| 標註 | 好友但拒絕推銷 | 第一關：命中黑名單「拒」 | ✗ 不發送 |
| 標註 | 天使不接電話 | 第二關：命中特殊規則「不」，但同時命中白名單「天使」例外 | ✓ 發送 |
| 標註 | 勿打擾 | 第二關：命中特殊規則「勿」，且無白名單例外 | ✗ 不發送 |
| 標註 | 勿久等請提早聯繫 | 第二關：未命中「勿」的特殊規則 | ✓ 發送 |
| 標註 | 天使會員 | 通過所有引導取消發送規則，預設通過 | ✓ 發送 |
| 標註 | 員工家屬 | 第一關：命中黑名單「員工」 | ✗ 不發送 |
| 接受電訪/銷 | promote = 0（開關打開） | 第三關：命中電訪銷規則 | ✗ 不發送 |
| 接受電訪/銷 | promote = 0（開關關閉） | 第三關：電訪銷開關未打開，通過 | ✓ 發送 |

> ### ⚠️ 實作重點提醒
> - **檢查時機：**在進入「發出簡訊內容」介面**之前**執行
> - **白名單優先：**天使/好友會員豁免所有黑名單規則
> - **關鍵字比對：**採用部分匹配（包含即符合）
> - **開關預設：**「接受電訪/銷」過濾預設關閉，避免誤攔
> - **不符合提示：**若客戶不符合資格，應顯示明確提示訊息
> - **記錄追蹤：**建議記錄因資格檢查而未發送的案例供後續分析

> ### 💡 與主流程的整合點
> **此檢查在以下時刻觸發：**
> 1️⃣ 新建預約後，準備發送提醒簡訊時
> 2️⃣ 修改預約（時間/門市）後，準備重新發送時
> 3️⃣ 取消最早預約，準備為次早預約補發時
> 4️⃣ 新增更早預約，準備為新最早發送時
> **所有情況都會先通過此檢查，才進入「發出簡訊內容」確認介面**

---

# 💾 資料庫欄位設計說明

> ### 🎯 核心欄位架構
> 為了實現簡訊發送優化，系統需要以下關鍵欄位來記錄和判斷預約簡訊狀態

## 資料表欄位定義

| 欄位名稱 | 資料類型 | 說明 | 範例值 |
|---|---|---|---|
| **RecordNo** | VARCHAR | 會員編號 | BC002183 |
| **CompanyId** | VARCHAR | 門市名稱 | 板橋光澤醫美 |
| **SYSGroup** | INT | 門市群組編號 (0=獨立) | 0, 1, 3 |
| **AppointmentId**| VARCHAR | 預約時間 | A1=2025-12-05(五)14:30 |
| **SysSend** | DATETIME | 簡訊預定發送時間 (NULL=不發送) | 2025-12-05(四)18:00 |
| **SysSendStatus**| INT | 簡訊發送狀態 (0=不發送, 1=發送) | 0 或 1 |

## 欄位設計重點說明

> ### 💡 核心設計原則
> - **SYSGroup 的作用：**決定採用「群組規則」還是「同門市規則」
> - **SysSend 與 SysSendStatus 配合：**SysSend 為 NULL 且 SysSendStatus = 0 表示不發送
> - **同一會員（RecordNo）同一天的預約：**根據 SYSGroup 判斷只保留最早一筆發送
> - **跨群組獨立：**不同 SYSGroup 的預約互不影響，各自判斷
> - **往最早的排程靠齊：**系統始終以當天最早預約為準發送簡訊

## 實際資料範例（含 UI 情境對應）

> ### 情境 1：標準發送（單一預約）
> **會員 BC002184 當天只有一個預約**
>
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002184 |
> | **CompanyId:** | 板橋光澤醫美 |
> | **SYSGroup:** | 1（群組1） |
> | **AppointmentId:** | A1=2025-12-05(五)10:30 |
> | **SysSend:** | 2025-12-05(四)18:00 |
> | **SysSendStatus:** | 1（會發送） |
>
> ✓ **判斷邏輯：**這是當天唯一預約，直接發送簡訊
> 💬 **對應 UI 情境：**情境 1 - 標準發送

> ### 情境 2：排程衝突（新增更早預約）
> **會員 BC002185 原有預約 14:30，新增 10:30 預約**
>
> #### 📌 原有預約（將被取消簡訊）
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002185 |
> | **CompanyId:** | 板橋岩盤浴 |
> | **SYSGroup:** | 1（群組1） |
> | **AppointmentId:** | A1=2025-12-05(五)14:30 |
> | **SysSend:** | ~~2025-12-05(四)18:00~~ → NULL |
> | **SysSendStatus:** | ~~1~~ → 0（改為不發送） |
>
> #### ✓ 新增預約（成為最早，將發送簡訊）
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002185 |
> | **CompanyId:** | 板橋光澤醫美 |
> | **SYSGroup:** | 1（群組1） |
> | **AppointmentId:** | A2=2025-12-05(五)10:30 |
> | **SysSend:** | 2025-12-05(四)18:00 |
> | **SysSendStatus:** | 1（會發送） |
>
> ✓ **判斷邏輯：**新增預約 10:30 早於原預約 14:30，往最早的排程靠齊
> 💬 **對應 UI 情境：**情境 3 - 排程衝突（新增更早預約）

> ### 情境 3：自動補位（取消最早預約）
> **會員 BC002186 原有兩個預約，取消最早的預約**
>
> #### ❌ 原最早預約（被取消）
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002186 |
> | **CompanyId:** | 板橋醫美 |
> | **SYSGroup:** | 3（群組3） |
> | **AppointmentId:** | A1=2025-12-05(五)09:00 |
> | **SysSend:** | NULL（已取消） |
> | **SysSendStatus:** | 0（不發送） |
>
> #### ✓ 次早預約（自動補位為最早）
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002186 |
> | **CompanyId:** | 板橋岩盤浴 |
> | **SYSGroup:** | 3（群組3） |
> | **AppointmentId:** | A2=2025-12-05(五)16:30 |
> | **SysSend:** | 2025-12-05(四)18:00 |
> | **SysSendStatus:** | 1（自動補位發送） |
>
> ✓ **判斷邏輯：**取消最早預約後，次早預約 16:30 自動成為新的最早預約
> 💬 **對應 UI 情境：**情境 5 - 自動補位（取消最早預約）

> ### 情境 4：黑名單客戶（不發送）
> **會員 BC002187 標註為黑名單**
>
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002187 |
> | **CompanyId:** | 板橋光澤醫美 |
> | **SYSGroup:** | 1（群組1） |
> | **AppointmentId:** | A1=2025-12-05(五)10:30 |
> | **Mark:** | 客人拒絕簡訊 |
> | **SysSend:** | NULL |
> | **SysSendStatus:** | 0（不發送） |
>
> ✗ **判斷邏輯：**客戶 Mark 欄位包含黑名單關鍵字「拒」，不發送簡訊
> 💬 **對應 UI 情境：**情境 2 - 客人拒收（黑名單）

> ### 情境 5：跨群組獨立發送
> **會員 BC002188 在不同群組各有一個預約**
>
> #### ✓ 群組1 預約（會發送）
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002188 |
> | **CompanyId:** | 板橋醫美 |
> | **SYSGroup:** | 3（群組3） |
> | **AppointmentId:** | A1=2025-12-05(五)09:00 |
> | **SysSend:** | 2025-12-05(四)18:00 |
> | **SysSendStatus:** | 1（會發送） |
>
> #### ✓ 群組2 預約（也會發送）
> | Key | Value |
> |---|---|
> | **RecordNo:** | BC002188 |
> | **CompanyId:** | 忠孝岩盤浴 |
> | **SYSGroup:** | 1（群組1） |
> | **AppointmentId:** | B1=2025-12-05(五)14:00 |
> | **SysSend:** | 2025-12-05(四)18:00 |
> | **SysSendStatus:** | 1（會發送） |
>
> ✓ **判斷邏輯：**不同 SYSGroup 的預約彼此獨立，各自判斷最早預約
> 💬 **適用情境：**跨群組預約各自發送，符合業務規則

---

# 🏢 完整門市清單與群組規劃
> 共 **27個門市**，建議設定 **5個消耗區域群組**

> ### 📊 門市分類概況
> • **消耗區域群組：**5個群組，共 **11家門市**（可跨群組內不同門市優化）
> • **同一門市規則：****16家門市**（僅限同一門市優化）

## 消耗區域門市群組設定
> **群組 1 - 忠孝區域 (2門市)**
> `忠孝岩盤浴`, `忠孝光澤`
>
> **群組 2 - 羅東區域 (2門市)**
> `羅東岩盤浴`, `羅東光澤`
>
> **群組 3 - 板橋區域 (2門市)**
> `板橋醫美`, `板橋岩盤浴`
> ⚠️ **板橋光澤健保** 已從此群組移除，改採「同一門市規則」
>
> **群組 4 - 中壢彤顏區域 (3門市)**
> `中壢彤顏健保`, `中壢彤顏醫美`, `中壢岩盤浴`
>
> **群組 5 - 台中區域 (2門市)**
> `台中光澤診所`, `台中岩盤浴`

> ### 📌 消耗區域群組小計
> **共 11 家門市**（2+2+2+3+2）
> 規則：同一會員在同一群組內（可跨門市）只發送**最早1封**

## 採用「同一門市規則」的門市
> 以下 **16個門市** 不在消耗區域群組內，採用「**同一門市規則**」
> `南西光澤診所`, `永和彤顏診所`, `古亭光澤`, `大直光澤診所`, `新竹光澤診所`, `高雄光澤`, `八德健保診所`, `三重光澤`, `桃園岩盤浴`, `林口彤顏診所`, `台北岩盤浴`, `新莊光澤診所`, `桃園彤顏健保`, `三峽光澤診所`, `三民光澤診所`, `板橋光澤健保 ⭐`
> 💡 這些門市的規則：**同一天 + 同一門市**的多個預約 → 只發送最早的一封簡訊
> ⭐ **板橋光澤健保** 從群組3例外移入此類別

---

# 🎬 模擬情境：門市群組規則

> ### 情境 A：板橋區域多預約
> | 時間 | 門市 | 會員 | 療程 | 簡訊狀態 |
> |---|---|---|---|---|
> | **10:00** | 板橋醫美 | 王小明 | 雷射除斑 | ✓ 發送 |
> | 16:30 | 板橋岩盤浴 | 王小明 | 岩盤浴療程 | ✗ 跳過 |
> **📊 結果分析：**2個預約跨2個門市，但屬於群組3（板橋區域）→ 只發送1封簡訊（節省50%）

> ### 情境 B：中壢彤顏區域跨門市
> | 時間 | 門市 | 會員 | 療程 | 簡訊狀態 |
> |---|---|---|---|---|
> | **10:30** | 中壢彤顏健保 | 李美麗 | 健保治療 | ✓ 發送 |
> | 15:00 | 中壢彤顏醫美 | 李美麗 | 美容療程 | ✗ 跳過 |
> | 17:30 | 中壢岩盤浴 | 李美麗 | 岩盤浴療程 | ✗ 跳過 |
> **結果：**3個預約跨3個門市，但都屬於群組4（中壢彤顏區域）→ 只發送1封簡訊（節省67%）

> ### 情境 C：忠孝區域同時段
> | 時間 | 門市 | 會員 | 療程 | 簡訊狀態 |
> |---|---|---|---|---|
> | **13:00** | 忠孝岩盤浴 | 陳大華 | 岩盤浴 | ✓ 發送 |
> | 13:30 | 忠孝光澤 | 陳大華 | 光澤療程 | ✗ 跳過 |
> **結果：**間隔僅30分鐘也只發1封（屬於群組1）

---

# 🎬 模擬情境：獨立門市規則

> ### 情境 D：三重光澤（獨立門市）
> | 時間 | 門市 | 會員 | 療程 | 簡訊狀態 |
> |---|---|---|---|---|
> | **10:00** | 三重光澤 | 張志明 | 醫美諮詢 | ✓ 發送 |
> | 15:00 | 三重光澤 | 張志明 | 療程治療 | ✗ 跳過 |
> | 18:00 | 三重光澤 | 張志明 | 術後追蹤 | ✗ 跳過 |
> **📌 規則說明：**三重光澤不在任何群組 → 採用「同門市規則」
> **結果：**同一門市3個預約 → 只發送最早的1封

> ### 情境 E：高雄光澤（獨立門市）
> | 時間 | 門市 | 會員 | 療程 | 簡訊狀態 |
> |---|---|---|---|---|
> | **09:00** | 高雄光澤 | 劉小芳 | 第一次療程 | ✓ 發送 |
> | 14:30 | 高雄光澤 | 劉小芳 | 第二次療程 | ✗ 跳過 |

> ### 情境 F：跨獨立門市（仍各發簡訊）
> | 時間 | 門市 | 會員 | 療程 | 簡訊狀態 |
> |---|---|---|---|---|
> | **10:00** | 三重光澤 | 黃美惠 | 預約A | ✓ 發送 |
> | **15:00**| 高雄光澤 | 黃美惠 | 預約B | ✓ 發送 |
> **⚠️ 注意：**不同獨立門市且無群組關係 → **各發1封**（共2封）。這是合理的，因為地理位置完全不同（三重 vs 高雄）

---

# 🎬 複雜情境：跨群組混合預約

> ### 情境 G：群組 + 獨立門市混合（真實案例）
> | 時間 | 門市 | 會員 | 所屬群組/規則 | 簡訊狀態 |
> |---|---|---|---|---|
> | **09:00** | 板橋醫美 | 王先生 | 群組3（板橋） | ✓ 發送 |
> | 11:30 | 板橋岩盤浴 | 王先生 | 群組3（板橋） | ✗ 跳過 |
> | **14:00** | 忠孝岩盤浴 | 王先生 | 群組1（忠孝） | ✓ 發送 |
> | 16:00 | 忠孝光澤 | 王先生 | 群組1（忠孝） | ✗ 跳過 |
> | **18:00** | 三重光澤 | 王先生 | 獨立門市 | ✓ 發送 |
> **🔍 判斷邏輯分析：**
> 1️⃣ 板橋醫美 + 板橋岩盤浴 = 群組3 → 只發1封（09:00）
> 2️⃣ 忠孝岩盤浴 + 忠孝光澤 = 群組1（不同群組）→ 只發1封（14:00）
> 3️⃣ 三重光澤 = 獨立門市（無群組關係）→ 發1封（18:00）
> **📊 最終結果：**5個預約發送3封簡訊（節省40%成本）

> ### 🚨 關鍵判斷流程
> 1. **在執行前檢測：**當用戶要取消/新增預約時，系統「立即」檢測影響
> 2. 取得該會員**當天所有預約**
> 3. 檢查該操作是否影響**最早預約順序**
> 4. 若有影響 → 彈出確認視窗，**讓用戶決定是否繼續**
> 5. 用戶確認後 → 執行操作（取消/新增預約）
> 6. 操作完成後 → 跳轉到簡訊發送介面，讓用戶決定是否發送
> 7. 不同群組且不同門市 → **各發1封**

---

# 🎯 前端 UI 互動設計規範

> ### 📋 設計規範說明
> 根據預約新增、取消、修改等操作，前端需要判斷並顯示對應的提示訊息和按鈕樣式。以下定義標準互動場景的 UI 設計規範。

> ### 🎯 核心設計原則
> 1. **往最早的排程靠齊** - 以當天最早預約為準發送簡訊
> 2. **預約不會被擋** - 簡訊規則只影響發送邏輯，不阻止預約建立
> 3. **以「當天 + SYSGroup」為單位** - 同一客戶同一天同一群組只發送最早一筆
> 4. **不同 SYSGroup 彼此獨立** - 各群組的簡訊狀態互不影響

## 彈窗共用結構

> ### 📱 簡訊確認視窗架構
> 當預約操作會影響簡訊發送時，系統彈出統一結構的確認視窗：
>
> **1. 標題列** - 簡訊發送 / 簡訊取消
> **2. 提醒資訊區** - 顯示 0~N 個提醒框（依重要性排序）
> **3. 簡訊預覽區** - 顯示/編輯簡訊內容與發送時間
> **4. 按鈕列** - 左側取消 / 右側確認

## 顏色與狀態定義

| 狀態 | 用途 | 視覺呈現 |
|---|---|---|
| **danger** 危險/高風險 | 違反客戶設定，可能帶來客訴 | 🚨 紅色系 |
| **warning** 警告/提醒 | 排程衝突，自動補位通知 | ⚡ 黃色/橘色系 |
| **success** 正向引導 | 系統建議執行的操作 | ✅ 綠色 |
| **default** 中立/取消 | 保守不做變更 | 🔘 灰色 |
| **info** 資訊提示 | 一般資訊說明 | ℹ️ 藍色系 |

## 標準互動場景

### 情境 1：標準發送

> **觸發條件：** 一般發送，沒有任何額外限制或衝突
>
> **彈窗標題：** 簡訊發送
>
> **提醒資訊：** 無
>
> **簡訊內容：**
> `提醒您有預約：【板橋光澤醫美】12/05 (五) 10:30，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-12-04 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：🔘 不發送 (default - 灰色)
> - 右側：✅ 確認發送 (success - 綠色)
>
> **系統引導傾向：** 中立略偏向發送

### 情境 2：客人拒收（黑名單）

> **觸發條件：** 客戶 Mark 欄位包含黑名單關鍵字，且不符合白名單條件
>
> **彈窗標題：** 簡訊發送
>
> **提醒資訊：**
> - 🚨 **danger（紅色）：**
>   - **發送受阻**
>   - 客人已設定「不要發送簡訊」，強制發送可能引起客訴。
>
> **簡訊內容：**
> `提醒您有預約：【板橋光澤醫美】12/05 (五) 10:30，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-12-04 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：⚠️ 不發送 (danger - 紅色)
> - 右側：🔘 確認發送 (default - 灰色)
>
> **系統引導傾向：** 強烈壓制誤發送
>
> **⚠️ 可合併多情境：** 此情境會與其他情境合併顯示，黑名單提示置於最上方

### 情境 3：排程衝突（有複數預約）

> **觸發條件：** 客人在同一天同一群組（或同門市）內有複數預約
>
> **彈窗標題：** 簡訊發送
>
> **提醒資訊：**
> - ⚡ **warning（黃色）：**
>   - **排程衝突**
>   - 客人已有複數預約如下：
>   - `2025-12-05 10:30 ← 最早預約（將發送簡訊）`
>   - `2025-12-05 14:30`
>   - `2025-12-05 16:00`
>   - 以最早預約簡訊為主，以下開放更新簡訊內容。
>
> **簡訊內容：**
> `提醒您有預約：【板橋光澤醫美】12/05 (五) 10:30，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-12-04 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：🔘 不發送 (default - 灰色)
> - 右側：✅ 確認發送 (success - 綠色)
>
> **系統引導傾向：** 引導發送最早預約簡訊
>
> **💡 適用場景：**
> - 新增更早預約時（新預約成為最早）
> - 新增次早預約時（顯示已有最早預約排程）
> - 任何導致複數預約的情況

### 情境 4：複合風險（黑名單+排程衝突）

> **觸發條件：** 同時觸發「客人拒收」和「排程衝突」
>
> **彈窗標題：** 發送受阻
>
> **提醒資訊：**
> - 🚨 **danger（紅色）：**
>   - **發送受阻**
>   - 客人已設定「不要發送簡訊」
> - ⚡ **warning（黃色）：**
>   - **排程衝突**
>   - 客人已有複數預約，以最早預約簡訊為主
>
> **簡訊內容：**
> `提醒您有預約：【板橋光澤醫美】12/05 (五) 10:30，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-12-04 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：⚠️ 不發送 (danger - 紅色)
> - 右側：🔘 確認發送 (default - 灰色)
>
> **系統引導傾向：** 強烈壓制誤發送

### 情境 5：自動補位（取消最早預約）

> **觸發條件：** 取消的預約是當天 SYSGroup（或同門市）內的最早預約，且存在次早預約
>
> **彈窗標題：** 簡訊發送
>
> **提醒資訊：**
> - ⚡ **warning（黃色）：**
>   - **自動補位通知**
>   - 當天尚有其他預約，系統將自動改以當天最早預約發送簡訊：
>   - `2025-12-05 14:00 （補位預約，將發送簡訊）`
>   - `2025-12-05 18:00`
>   - 系統將自動改以 12/05 14:00 預約發送通知簡訊，您可於下方編輯內容。
>
> **簡訊內容：**
> `提醒您有預約：【板橋岩盤浴】12/05 (五) 14:00，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-12-04 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：🔘 不發送 (default - 灰色)
> - 右側：✅ 確認發送 (success - 綠色)
>
> **系統引導傾向：** 引導發送補位通知簡訊

> ### 💡 UI 設計重點總結
> - **✅ 綠色：** 正面建議操作（發送/確認發送）
> - **🔘 灰色：** 中性或取消操作（不發送/取消發送）
> - **⚠️ 紅色：** 強烈警示（黑名單不發送）
> - **⚡ 黃色：** 提醒注意（排程衝突、自動補位）
> - **危險情境優先：** danger 提醒置於最上方，其次 warning，最後 info
> - **一致性原則：** 相同互動場景使用相同的配色和文案結構
> - **情境 3 涵蓋所有排程衝突：** 無論新增更早或次早預約，都以「往最早的排程靠齊」為準

---

# 🎬 補發情境：完整流程模擬

> ### 情境 H：群組內最早預約取消後的自動補位流程
>
> #### 【初始狀態】客戶當天在板橋區域有2個預約
> | 時間 | 門市 | 療程 | 群組 | 初始狀態 |
> |---|---|---|---|---|
> | **09:00** | 板橋醫美 | 雷射除斑 | 群組3 | ✓ 最早（已排程簡訊） |
> | 16:30 | 板橋岩盤浴 | 岩盤浴療程 | 群組3 | ⏸️ 次早（待補位） |
>
> #### 【用戶操作】點擊取消 09:00 預約
> ⚡ **系統立即檢測（往最早的排程靠齊）：**
> - 這是當天最早預約，且有次早預約存在
> - 次早預約 16:30 將自動成為新的最早預約
> - 準備為次早預約補發簡訊
>
> #### 【彈窗標題】簡訊發送
>
> #### 【提醒資訊】
> - ⚡ **warning（黃色）：**
>   - **自動補位通知**
>   - 當天尚有其他預約，系統將自動改以當天最早預約發送簡訊：
>   - `2025-11-13 16:30 （補位預約，將發送簡訊）`
>   - 系統將自動改以 11/13 16:30 預約發送通知簡訊，您可於下方編輯內容。
>
> **收件人：**王小姐 (0912-345-678)
>
> **簡訊內容：**
> `提醒您有預約：【板橋岩盤浴】11/13 (三) 16:30，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-11-12 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：🔘 不發送 (default - 灰色)
> - 右側：✅ 確認發送 (success - 綠色)
>
> **系統引導傾向：** 引導發送補位通知簡訊
>
> #### 【結果】完成取消並發送補位簡訊
> | 時間 | 門市 | 療程 | 群組 | 新狀態 |
> |---|---|---|---|---|
> | 09:00 | 板橋醫美 | 雷射除斑 | 群組3 | ❌ 已取消 |
> | **16:30**| 板橋岩盤浴 | 岩盤浴療程 | 群組3 | ✓ 新最早（已補位發送簡訊） |

> ### 情境 I：獨立門市的自動補位流程
>
> #### 【初始狀態】客戶當天在三重光澤有2個預約
> | 時間 | 門市 | 療程 | 規則 | 初始狀態 |
> |---|---|---|---|---|
> | **10:00** | 三重光澤 | 醫美諮詢 | 同門市 | ✓ 最早（已排程簡訊） |
> | 15:00 | 三重光澤 | 療程治療 | 同門市 | ⏸️ 次早（待補位） |
>
> #### 【用戶操作】點擊取消 10:00 預約
> ⚡ **系統立即檢測（往最早的排程靠齊）：**
> - 這是當天同門市內最早預約，且有次早預約存在
> - 次早預約 15:00 將自動成為新的最早預約
> - 準備為次早預約補發簡訊
>
> #### 【彈窗標題】簡訊發送
>
> #### 【提醒資訊】
> - ⚡ **warning（黃色）：**
>   - **自動補位通知**
>   - 當天尚有其他預約，系統將自動改以當天最早預約發送簡訊：
>   - `2025-11-13 15:00 （補位預約，將發送簡訊）`
>   - 系統將自動改以 11/13 15:00 預約發送通知簡訊，您可於下方編輯內容。
>
> **收件人：**李小姐 (0912-567-890)
>
> **簡訊內容：**
> `提醒您有預約：【三重光澤】11/13 (三) 15:00，電話02-xxxx-xxxx，如須改約請聯繫您的專屬諮詢師。`
>
> **簡訊發送時間：** 2025-11-12 18:00
>
> **內容可編輯：** ✅ 是
>
> **按鈕配置：**
> - 左側：🔘 不發送 (default - 灰色)
> - 右側：✅ 確認發送 (success - 綠色)
>
> **系統引導傾向：** 引導發送補位通知簡訊

> ### 🚨 重要判斷原則
> - **群組內補位：**只在同一門市群組內尋找次早預約
> - **門市內補位：**獨立門市只在同一門市內尋找次早預約
> - **跨群組不補：**不同群組或不同獨立門市之間不會互相補位
> - **動態更新：**每次預約變動都會重新計算最早與次早

---

# ✅ 已確認的決策事項

> ## 📋 本次會議已確認的決策
>
> ### 決策 1：門市群組設定
> **✓ 確認設定 5 個消耗區域群組，共涵蓋 11 個門市**
>
> ### 決策 2：簡訊發送規則
> **✓ 採用兩層判斷機制（群組優先 → 單一門市）**
>
> ### 決策 3：簡訊內容格式
> **✓ 只提最早預約時間**
>
> ### 決策 4：取消/新增預約處理方式（✨ 更新）
> **✓ 在執行前先檢測並確認（讓用戶有反悔機會）**

> ### 💡 決策理由說明
> - **成本優先：**透過群組規劃，最大化簡訊費用節省效益
> - **避免誤操作：**在執行前先檢測並確認，讓用戶有反悔機會
> - **提升效率：**自動檢測機制減少人工判斷時間與遺漏風險
> - **操作一致：**使用現有共用元件，降低學習成本
> - **保持彈性：**用戶在發送介面做最終決定，特殊情況（VIP、重要療程）可妥善處理
> - **風險可控：**每次操作前都先確認影響，降低服務風險

---

# 📅 實施時程與監控指標

## 開發時程規劃

| 階段 | 工作項目 | 預估時間 | 負責單位 | 優先級 |
|---|---|---|---|---|
| **需求確認** | 確認門市群組、簡訊格式、補發流程 | 3-5天 | PM | 🔴 高 |
| **系統開發** | 開發群組設定、簡訊邏輯、提醒介面 | **1-1.5週** | 工程團隊 | 🔴 高 |
| **測試驗證** | 功能測試、補發測試、使用者驗收 | **1週** | QA團隊 | 🟡 中 |
| **試運行** | 小範圍上線、監控數據、收集反饋 | **1週** | 全體 | 🟡 中 |
| **正式上線** | 全門市部署、員工教育訓練、持續監控 | 持續 | 全體 | 🟢 持續 |

> ### ⏱️ 總時程預估
> **從開發到試運行完成：約 3-3.5 週**
> （不含需求確認階段與正式上線後的持續優化）

## 關鍵監控指標（KPI）

> **📉 簡訊成本:** -35% 目標節省比例
> **📊 爽約率:** ≤5% 不應上升
> **⭐ 補發決策率:** 記錄追蹤分析

> ### 📊 預期效益試算（以月均10,000筆預約為例）
> | 項目 | 優化前 | 優化後 | 節省 |
> |---|---|---|---|
> | 月預約數 | 10,000 筆 | 10,000 筆 | - |
> | 簡訊發送數 | 10,000 封 | 6,500 封 | **3,500 封** |
> | **簡訊成本（@0.7元/封）** | **7,000 元** | **4,550 元** | **2,450 元/月** |
> | **年度節省** | | | **約 29,400 元/年** |

---

# ✅ 決策總結與行動項目

> ## 📝 會議決議記錄
>
> ### 決策 1：門市群組設定
> **✓ 確認設定 5 個消耗區域群組，共涵蓋 11 家門市**
>
> ### 決策 2：簡訊發送規則
> **✓ 採用兩層判斷機制（群組優先 → 單一門市）**
>
> ### 決策 3：簡訊內容格式
> **✓ 只提最早預約時間**
>
> ### 決策 4：取消/新增預約處理方式（✨ 更新）
> **✓ 在執行前先檢測並確認（讓用戶有反悔機會）**

## 後續行動清單

| 優先級 | 行動項目 | 負責人 | 期限 | 狀態 |
|---|---|---|---|---|
| 🔴 最高 | 確認5個消耗區域群組設定是否完整正確 | 營運部 | 2天內 | ⏳ 待辦 |
| 🔴 最高 | 設計補發提醒介面原型 | PM + UI | 3天內 | ⏳ 待辦 |
| 🟡 高 | 開發門市群組設定與管理功能 | 工程團隊 | 1週內 | ⏳ 待辦 |
| 🟡 高 | 開發次早預約自動提醒機制 | 工程團隊 | 1.5週內 | ⏳ 待辦 |
| 🟢 中 | 準備使用者教育訓練材料 | 教育訓練組 | 3週內 | ⏳ 待辦 |
| 🟢 中 | 建立監控數據分析報表（含補發決策追蹤） | 數據分析 | 4週內 | ⏳ 待辦 |

> ### 🚀 開始執行準備
> **✓ 所有決策已確認完成**
> 接下來進入開發與實施階段，預計 3-3.5 週內完成系統建置與測試

---

# 謝謝聆聽 🙏
> 期待您的寶貴意見與決策

> **門市總數:** 27
> **消耗區域群組:** 5
> **預期節省:** 35% 簡訊成本

> 📧 如有任何問題或建議，請隨時與專案團隊聯繫
> 📊 下次會議將確認最終決策並啟動開發
